- **核心是将不符合预期的数据进行处理**

## 1. 缺失值处理

- 现实中数据往往是不全面的，很多样本的特征值有缺失，常用缺失值处理方法包括：删除，简单替换，模型替换

#### 1.1 删除

- 删除具有缺失值的记录，不过通常数据非常重要，一般不推荐这样做
- 适用于 完全随机缺失 的场景
  - 假设现在有一个数据集，体重特征值存在缺失
  - **非随机缺失**
    - 数据缺失的概率与 **未观测的真实值**（ 即缺失值的真实值 ） 相关
    - 例如 体重高的人（ 未观测的真实值 ），更容易隐瞒体重
  - **随机缺失**
    - 数据缺失的概率仅由 **已观测到的变量** 决定，但不依赖未观测的真实值
    - 例如 女性（ 已观测值 ）更容易隐藏体重，而 体重实际值的高低（ 未观测的真实值 ）则不会影响缺失概率
  - **完全随机缺失**
    - 数据缺失的概率 与所有 已观测数据 和 未观测数据 均无关，即缺失是完全随机发生的

#### 1.2 简单替换

- 虚拟替换
  - 使用虚拟值替换缺失值，例如用 unknown 替换分类值
  - **但用 0 替换数值容易产生问题**，因为使用 0 填充缺失值可能会改变数据的分布特征，特别是当缺失值的比例较大时，可能会使数据的均值、方差等统计量发生较大变化
- 平均数，众数替换
  - 使用 平均数 或 众数 替换缺失值
- 分位数填充
  - 使用中位数，或者 P25/P75 等自定义分位的值替换缺失值，可以应对不同的数据分布情况
- 常用项替换
  - 如果缺失的是 **分类数据**，则使用最常用的项替换缺失值
- 前后向替换
  - 用前 n 个，后 n 个，或前后 n 个非缺失值的统计值填充，适用于时间序列数据

#### 1.3 模型替换

- 使用 KNN 替换（ 认为相邻数据之间存在关联 ）
  - 缺失样本点周围最近的 k 个样本的均值或最大值填充
  - 但是存在使用前提
    - **离散型数据不合适**，样本附近需要有关联的，比如时序数据
    - **数据不能是连片缺失**，否则缺失样本点周围的样本也有缺失值
- 使用 线性回归 替换（ 认为特征之间存在关联 ）
  - 在缺失值填充的场景中，对于包含缺失值的特征，我们将其视为因变量，其余无缺失值的特征作为自变量
  - 通过利用无缺失值的样本数据训练线性回归模型，学习自变量和因变量之间的线性关系（ 比如 “房屋面积” 和 “房屋价格” ），然后使用训练好的模型对缺失值进行预测和填充
  - 注意线性回归假设 **特征之间存在线性关系**，如果实际数据关系是非线性的，填充效果可能不佳
- 使用 随机森林 替换（ 认为特征之间存在关联 ）
  - 随机森林由多个决策树组成，其基本思想是将有缺失值的特征作为目标变量，其余特征作为输入特征，利用随机森林模型的学习和预测能力来估计缺失值
  - 将数据集划分为有缺失值的部分和无缺失值的部分，无缺失值的部分用于训练随机森林模型，有缺失值的部分则进行预测

## 2. 异常值处理

- 分为 **检测** 和 **处理** 两个阶段
- 检测
  - 常用 Z-score 方法 和 IQR 方法，通常搭配可视化图表观察
  - **Z-score 方法**
    - 该方法基于数据的均值和标准差来判断数据点是否为异常值，**适用于数据近似服从正态分布的情况**
    - 假设数据服从正态分布，对于一个数据点，其 Z-score 的计算公式为 Z = (x - μ) / σ，其中 μ 是数据的均值，σ 是数据的标准差。一般来说，当 |Z| > 3 时，可认为该数据点是异常值
  - **IQR（ Interquartile Range，四分位距 ）方法**
    - 该方法基于数据的上四分位数与下四分位数之差，**对数据分布没有严格要求，对异常值不敏感，适用于各种类型的数据分布**
    - 假设数据从小到大排列，得到第四分之一位次的数（ 下四分位数，$Q_1$ ）和第四分之三位次的数（ 上四分位数，$Q_3$ ），然后计算出 IQR = $Q_3$ - $Q_1$，最后确定数据的下限 $Q_1$ - 1.5 \* IQR 和上限 $Q_3$ + 1.5 \* IQR。超出这个范围的数据点被视为异常值
- 处理
  - 和缺失值的处理相似，可以替换或删除，但是多了 **保留** 这个处理方案，合理保留异常值可以提升模型的鲁棒性

## 3. 规则校验处理

- 时间逻辑校验
  - 例如 开始时间 ≤ 结束时间，出生日期 ≤ 注册日期，订单创建时间晚于发货时间
- 数值逻辑校验
  - 例如 折扣价 ≤ 原价，库存 ≥ 已售数量，促销价高于原价
- 重复值校验
  - 例如 订单号相同，且内容也完全相同
- 业务逻辑校验
  - 例如 会员等级与消费金额匹配，地理位置与 IP 地址一致
