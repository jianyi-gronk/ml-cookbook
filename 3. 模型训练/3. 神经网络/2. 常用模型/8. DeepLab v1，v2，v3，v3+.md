## 1. DeepLabV1

- DeepLabV1 的核心思想是使用深度卷积神经网络（ DCNN ）来解决语义分割问题，并在此基础上引入了一些关键技术来提高性能
- DeepLabV1 的 backbone 为 vgg16

#### 1.1 分类模型和分割模型的区别

- 空间不变性，即即使对象在图像中发生轻微的平移、旋转或缩放，网络仍能够识别对象
- **分类任务具有空间不变性**，图像的仿射变换不会影响最后的分类结果，而且恰恰通过仿射变换等操作（ 数据增广 ）可以增加数据量，提高模型的精度。**但是像分割和检测这类问题，不具有空间不变性**
- **处理分割和检测的模型需要能够对空间细节进行敏感处理**，而不是忽略这些细节。相比之下，对象分类问题更侧重于识别整体对象的特征，对对象出现在图像中的位置不那么敏感

#### 1.2 DCNN 存在的问题

- DCNN 的基本原理是通过卷积和池化操作来提取图像中的特征，并通过全连接层进行分类或回归任务
- 但是 DCNN 应用在语义分割任务上存在三个缺陷
  - 重复堆叠的下采样操作（ 卷积和池化 ）导致分辨率大幅下降，位置信息丢失难以恢复
  - DCNN 从分类器获得以对象为中心的决策需要空间转换的不变性，但是却忽略对细节处的把控，限制了空间准确性
  - 多个尺度上存在对象（ 这个在 deeplabv2 中得以解决 ）
- 因此 DCNN 这种对象分类模型不适合处理图像分割问题，需要进行修改
- DeepLabV1 解决方案
  - 使用空洞卷积解决下采样的问题
  - 使用密集条件随机场（ DenseCRF ）解决了空间不变性的问题

#### 1.3 解决下采样问题

- 空洞卷积（ Dilated Convolution ）也叫扩张卷积（ Atrous Deconvolution ），是针对图像语义分割问题中下采样带来的图像分辨率降低、信息丢失问题而提出的一种新的卷积思路
- 空洞卷积通过引入扩张率（ Dilation Rate ）这个参数定义了卷积核中两相邻元素的距离，使得同样尺寸的卷积核获得更大的感受野。相应地，也可以使得在相同感受野大小的前提下，空洞卷积比普通卷积的参数量更少
- 扩张率分别为 1，2，4 时
  ![image](https://github.com/user-attachments/assets/6b55f8d9-cc84-4dbe-86dd-5821b78a6c71)
  - 扩张率为 1 时，空洞卷积与标准卷积计算方式一样
  - 扩张率大于 1 时，在标准卷积的基础上，会注入空洞，空洞中的数值全部填 0
  - 原始卷积核大小为 3 \* 3，扩张率为 1，2，4 时，感受野大小分别为 3 \* 3，5 \* 5，9 \* 9
- **DeepLabV1 解决下采样的问题的具体方案为，通过空洞卷积增大感受野，同时增加 padding 保持图像分辨率**，而摒弃 FCN 传统的先下采样再上采样的操作
- 空洞卷积的不足
  - 空洞卷积固然可以增大感受野，但不难看出它其实是忽略了一部分的像素间信息，会导致局部相关性丢失，并且在小尺度检测问题上比较无力

#### 1.4 解决空间不变性问题

- 为了得到更精确的最终分类结果，通常要进行一些图像后处理。DenseCRF 是在目前深度学习图像分割应用中常用的一种图像后处理方式，它是 CRF 的改进模式，能够结合原始影像中所有像素之间的关系对深度学习得到的分类结果进行处理，优化分类图像中粗糙和不确定性的标记，修正细碎的错分区域，同时得到更细致的分割边界
- 如图所示，有一张有一个小人的图像，需要对图像中的各个像素进行分类，△ 代表一个像素，像素集合为 X，每一个像素所对应隐式类别 ⭕️ 为 z, 组成类别集合 Z，观测即为像素的颜色、位置特征，需要推论的隐变量即为每个像素的类别
  ![image](https://github.com/user-attachments/assets/3c761db0-cbde-4d88-8888-747ac2b4b7d9)
- 假如每一个像素的类别只和自己的像素特征相关，如下图所示，意味着对每一个像素单独进行一次分类
  ![image](https://github.com/user-attachments/assets/207d1c1e-d171-4abd-a0a9-4475132b329e)
- 但是仅从一个像素所具有的特征是无法有效的对像素进行分类的，一个像素的类别应该与它的邻域甚至所有像素相关
  ![image](https://github.com/user-attachments/assets/b1b0be17-1601-445f-8588-24ab4225f12d)
- 一个像素的类别不光受与所有像素相关. 同时也与所有像素的类别相关，称为 DenseCRF，由于链接太多，仅画出示意，如下图
  ![image](https://github.com/user-attachments/assets/80855d03-5fe6-41a7-b6ff-515e6733d874)

#### 1.5 优点

- 效果：在 PASCAL VOC 2012 上获得了当时的最有性能，在测试集上达到了 71.6% 的 IOU，高于第二名 7.2% 个点
- 速度：带空洞卷积的基于 VGG16 基础结构的 DCNN，可以达到 8fps，而后处理的全连接 CRF 只需要 0.5s
- 简单：系统只由两个非常成熟的模块的结合，DCNN 和 CRF

## 2. DeepLabV2

#### 2.1 相对于 DeepLabV1 的优化

- 使用 ResNet101 替代 vgg16，做基础网络的改进，可以得到更好的准确性
- 主要是添加了对多尺度问题的处理。通过引入空洞空间金字塔池化模块（ Atrous Spatial Pyramid Pooling，ASPP ），以多尺度的方式捕获语境信息，并通过融合不同分辨率的特征图来增强语义分割的性能
- PASCAL VOC-2012 测试集达到了 79.7% 的 mIOU 准确性

#### 2.2 空洞空间金字塔池化

- 下图是原论文中介绍 ASPP 的示意图
  ![image](https://github.com/user-attachments/assets/cf9c3172-fbca-471f-9fe5-fe8ec9493163)
  - 每个分支的扩张系数不同，因此每个分支的感受野是不一样的，最终将 4 个分支的结果进行融合就使得 DeepLab v2 具有了解决多尺度的能力
- 在论文中有给出两个 ASPP 的配置
  - ASPP-S，四个分支膨胀系数分别为 [2,4,8,12]
  - ASPP-L，四个分支膨胀系数分别为 [6,12,18,24]
  - 在使用 DeepLab v2 时一般使用 ASPP-L

## 3. DeepLabV3

#### 3.1 相对于 DeepLabV2 的优化

- 对 backbone 模型 Resnet101 进行改造
- 取消 DenseCRF 后处理模块
- 在 PASCAL VOC-2012 测试集达到了 86.9% 的 mIOU 准确性

#### 3.2 改造 Resnet101 模型

- 网络变得更深，在第 4 个 block 后面，重复的堆叠了 3 个第四个 block 模块，形成了 block5，block6，block7 模块。同时对网络结构的下采样率进行了调整，原始的 Resnet101 进行了 5 次下采样，而修改后的 deeplab v3 只进行了 4 次下采样，从第三个 block 之后，就不需要进行下采样操作
  ![image](https://github.com/user-attachments/assets/fed1fc8d-b9e4-4bf3-8ba7-e2d98d096d78)
- 增加了基于 cascade 的 spp 模块。也就是 block4，block5，block6，block7 模块
- 修改了 ASPP-L 模块，去掉了 deeplab v2 中 ASPP 模块中的 rate = 24 的 3 \* 3 卷积，增加了 1 \* 1 卷积和全局 pooling 模块。也可以理解为将原始的 rate = 24 的 3 \* 3 卷积模块替换为 1 \* 1 卷积模块

#### 3.3 取消 DenseCRF 的原因

- 语义分割与分类不同。分类主要是识别物体，而语义分割不但要识别物体，还要找出物体的位置信息。DCNN 卷积网络越深，其位置信息丢失的越严重。所以在 deeplab v1/v2 中用到了，通过 DenseCRF 增强其位置信息
- 但是在 deeplabv3 中，使用大采样率的 3 \* 3 空洞卷积，图像边界响应无法捕捉远距离信息，会退化为 1 \* 1 的卷积，所以 deeplabv3 将图像级特征融合到 ASPP 模块中。融合图像级特征，相当于融合了其位置信息。所以用了 CRF，其精度也增加的不多，就不需要再用到 CRF 了

## 4. DeepLabV3+

#### 4.1 相对于 DeepLabV3 的优化

- 网络结构增加了 Decoder 模块，整体结构变成 Encoder-Decoder 模块
  ![image](https://github.com/user-attachments/assets/490b6999-cda0-4821-894e-f462935940ae)
  - a 图为 deeplab v2 的结构，b 图为 Encoder-Decoder 结构，c 图将 a,b 图的结构进行了整和，也就是 DeepLabV3+ 的结构
- 基础结构从 Resnet101 修改为 Xception
- PASCAL VOC-2012 测试集达到了 89.0% 的 mIOU 准确性

#### 4.2 基础结构改造原因

- 这样可以引了深度可分离卷积的思想，同时对其进行改进，将深度可分离卷积替代为空洞深度可分离卷积，可以获得比 Resnet101 更好的效果，更快的速度
- 同时对 Xception 结构进行了改进
  - 深度进行了加深，Middle Flow 从原始的重复 8 次变为重复 16 次
  - Max pooling 换成了 stride = 2 的深度可分离卷积
  - 在 3 \* 3 的深度可分离卷积后面增加 BN + Relu
